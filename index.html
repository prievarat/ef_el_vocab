<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Vocab Cloud</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary-500: #F4A329; --primary-700: #B45309;
            --secondary-500: #2BB6B4; --bg: #FFF7F2; --surface: #FFFFFF; --border: #E6E9EF;
            --text: #1F2937; --text-muted: #6B7280;
            --success: #2F9E44; --error: #D92D20; --radius: 16px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Nunito', sans-serif; background-color: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .container { width: 100%; max-width: 600px; }
        .progress-container { width: 100%; height: 10px; background: #E2E8F0; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--secondary-500); width: 0%; transition: width 0.4s ease; }
        .card { background: var(--surface); border-radius: var(--radius); padding: 24px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); margin-bottom: 20px; border: 1px solid var(--border); position: relative; }
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; background: #eee; padding: 4px; border-radius: 14px; }
        .tab { flex: 1; padding: 10px; border-radius: 10px; border: none; cursor: pointer; font-weight: 700; background: transparent; transition: 0.2s; font-family: inherit; }
        .tab.active { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); color: var(--primary-700); }
        .pill-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; justify-content: center; }
        .pill { padding: 6px 14px; border-radius: 9999px; border: 2px solid var(--border); cursor: pointer; font-size: 13px; font-weight: 600; background: white; }
        .pill.active { border-color: var(--primary-500); background: var(--primary-500); color: white; }
        .flashcard-container { perspective: 1000px; height: 220px; cursor: pointer; margin-bottom: 20px; }
        .flashcard { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: var(--radius); padding: 20px; border: 2px solid var(--primary-500); background: white; text-align: center; }
        .card-back { background: var(--secondary-500); color: white; transform: rotateY(180deg); border: none; }
        .word-txt { font-size: 26px; font-weight: 700; }
        .btn-main { background: var(--primary-500); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: 700; cursor: pointer; width: 100%; margin-top: 15px; font-size: 16px; }
        input[type="text"] { width: 100%; padding: 16px; border-radius: 12px; border: 2px solid var(--border); font-size: 18px; font-family: inherit; outline: none; margin-top: 15px; }
        input.correct { border-color: var(--success); background: #f0fff4; }
        input.wrong { border-color: var(--error); background: #fef2f2; }
        .hidden { display: none; }
    </style>
</head>
<body>
<div class="container">
    <header><h1 style="text-align: center; margin-bottom:10px; color:var(--primary-700);">Infinity Vocab Cloud</h1><div class="pill-container" id="unit-pills"></div></header>
    <div class="progress-container"><div class="progress-bar" id="p-bar"></div></div>
    <div class="tabs">
        <button class="tab active" onclick="switchTab('cards')">K√°rty√°k</button>
        <button class="tab" onclick="switchTab('practice')">Gyakorl√°s</button>
    </div>
    <div id="view-cards" class="card">
        <div class="flashcard-container" onclick="this.querySelector('.flashcard').classList.toggle('flipped')">
            <div class="flashcard" id="card-inner">
                <div class="card-face"><div class="word-txt" id="card-front">V√°lassz fejezetet!</div></div>
                <div class="card-face card-back"><div class="word-txt" id="card-back">...</div></div>
            </div>
        </div>
        <button class="btn-main" onclick="nextCard()">K√∂vetkez≈ë sz√≥</button>
    </div>
    <div id="view-practice" class="card hidden">
        <div id="p-engine">
            <h2 id="p-prompt" style="text-align: center; font-size: 24px;">Prompt</h2>
            <input type="text" id="p-input" placeholder="V√°lasz..." autocomplete="off">
            <div id="p-feedback" style="text-align:center; padding:15px; font-weight:700; min-height:80px;"></div>
            <button class="btn-main" id="check-btn" onclick="check()">Ellen≈ërz√©s</button>
            <button class="btn-main hidden" id="next-btn" onclick="nextTask()">K√∂vetkez≈ë ‚ûî</button>
        </div>
    </div>
</div>
<script>
    let vocabData = {}; let activeUnits = []; let pool = []; let idx = 0; let currentTask = null; let hasChecked = false;

    async function fetchUnits() {
        try {
            const response = await fetch('data/units.json');
            const list = await response.json();
            renderPills(list);
        } catch (e) { console.error("Units bet√∂lt√©si hiba:", e); }
    }

    async function loadUnitData(name) {
        if (!vocabData[name]) {
            try {
                // ITT VOLT A HIBA: backtick-et kell haszn√°lni!
                const response = await fetch(`data/${name}.json`);
                vocabData[name] = await response.json();
            } catch (e) { console.error(`Hiba a ${name}.json bet√∂lt√©sekor:`, e); }
        }
        refreshPool();
    }

    function renderPills(list) {
        const cont = document.getElementById('unit-pills');
        cont.innerHTML = '';
        list.forEach(name => {
            const p = document.createElement('div');
            p.className = `pill ${activeUnits.includes(name) ? 'active' : ''}`;
            p.innerText = name;
            p.onclick = async () => {
                if (activeUnits.includes(name)) {
                    activeUnits = activeUnits.filter(u => u !== name);
                } else {
                    activeUnits.push(name);
                    await loadUnitData(name);
                }
                renderPills(list);
                refreshPool();
            };
            cont.appendChild(p);
        });
    }

    function refreshPool() {
        pool = [];
        activeUnits.forEach(u => {
            if (vocabData[u]) pool = [...pool, ...vocabData[u]];
        });
        pool.sort(() => Math.random() - 0.5);
        idx = 0;
        updateUI();
        if (pool.length > 0 && document.getElementById('view-practice').classList.contains('hidden') === false) {
            nextTask();
        }
    }

    function switchTab(t) {
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        const btn = document.querySelector(`button[onclick*='${t}']`);
        if(btn) btn.classList.add('active');
        ['view-cards', 'view-practice'].forEach(v => document.getElementById(v).classList.add('hidden'));
        document.getElementById(`view-${t}`).classList.remove('hidden');
        if (t === 'practice' && pool.length > 0) nextTask();
    }

    function nextCard() {
        if(pool.length > 0) {
            idx = (idx + 1) % pool.length;
            updateUI();
            document.getElementById('card-inner').classList.remove('flipped');
        }
    }

    function nextTask() {
        if (pool.length === 0) return;
        hasChecked = false;
        const item = pool[idx];
        currentTask = { q: item.en, a: item.hu };
        document.getElementById('p-prompt').innerText = currentTask.q;
        document.getElementById('p-input').value = '';
        document.getElementById('p-input').className = '';
        document.getElementById('p-input').disabled = false;
        document.getElementById('p-feedback').innerHTML = '';
        document.getElementById('check-btn').classList.remove('hidden');
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('p-input').focus();
    }

    function check() {
        const user = document.getElementById('p-input').value.trim().toLowerCase();
        const correct = currentTask.a.toLowerCase();
        hasChecked = true;
        document.getElementById('p-input').disabled = true;
        if (user === correct) {
            document.getElementById('p-feedback').innerHTML = "<span style='color:var(--success)'>Zseni√°lis! üéâ</span>";
            document.getElementById('p-input').className = 'correct';
        } else {
            document.getElementById('p-feedback').innerHTML = `<span style='color:var(--error)'>Helyesen: <b>${currentTask.a}</b></span>`;
            document.getElementById('p-input').className = 'wrong';
        }
        document.getElementById('check-btn').classList.add('hidden');
        document.getElementById('next-btn').classList.remove('hidden');
        idx = (idx + 1) % pool.length;
    }

    function updateUI() {
        if(pool.length > 0) {
            document.getElementById('card-front').innerText = pool[idx].en;
            document.getElementById('card-back').innerText = pool[idx].hu;
            document.getElementById('p-bar').style.width = ((idx/pool.length)*100) + '%';
        }
    }

    document.getElementById('p-input').addEventListener('keypress', e => {
        if(e.key === 'Enter') hasChecked ? nextTask() : check();
    });

    fetchUnits();
    lucide.createIcons();
</script>
</body>
</html>
